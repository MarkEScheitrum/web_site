<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genealogy Record Editor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { margin: 5px; padding: 8px; }
        .form-container { margin-top: 20px; }
        label { display: block; margin: 5px 0; }
        input, textarea { width: 100%; max-width: 500px; }
        textarea { height: 80px; }
    </style>
</head>
<body>
    <h2>Genealogy Record Editor</h2>
    <input type="file" id="textFile" accept=".txt">
    <button onclick="loadRecords()">Load Records</button>
    <table id="recordTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Birth Date</th>
                <th>Birth Place</th>
                <th>Marriage</th>
                <th>Death Date</th>
                <th>Death Place</th>
                <th>Burial Place</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="recordBody"></tbody>
    </table>
    <div class="form-container">
        <h3>Add/Edit Record</h3>
        <input type="hidden" id="editIndex">
        <label>ID: <input type="number" id="id"></label>
        <label>Name: <input type="text" id="name"></label>
        <label>Birth Date: <input type="text" id="birthDate"></label>
        <label>Birth Place: <input type="text" id="birthPlace"></label>
        <label>Marriage: <input type="text" id="marriage"></label>
        <label>Death Date: <input type="text" id="deathDate"></label>
        <label>Death Place: <input type="text" id="deathPlace"></label>
        <label>Burial Place: <input type="text" id="burialPlace"></label>
        <label>Notes: <textarea id="notes"></textarea></label>
        <button onclick="addOrUpdateRecord()">Save Record</button>
    </div>
    <button onclick="downloadText()">Download Updated Records</button>

    <script>
        let records = [];

        function loadRecords() {
            const fileInput = document.getElementById('textFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a text file.');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    records = parseTextFile(e.target.result);
                    displayRecords();
                } catch (error) {
                    alert('Error reading text file. Please ensure it follows the correct format.');
                }
            };
            reader.readAsText(file);
        }

        function parseTextFile(text) {
            const recordStrings = text.trim().split('---\n');
            const parsedRecords = [];
            for (const recordStr of recordStrings) {
                if (recordStr.trim() === '') continue;
                const lines = recordStr.trim().split('\n');
                const record = {};
                for (const line of lines) {
                    const [key, value] = line.split(': ', 2);
                    if (key === 'ID') record.id = value || '';
                    if (key === 'Name') record.name = value || '';
                    if (key === 'Birth Date') record.birthDate = value || '';
                    if (key === 'Birth Place') record.birthPlace = value || '';
                    if (key === 'Marriage') record.marriage = value || '';
                    if (key === 'Death Date') record.deathDate = value || '';
                    if (key === 'Death Place') record.deathPlace = value || '';
                    if (key === 'Burial Place') record.burialPlace = value || '';
                    if (key === 'Notes') record.notes = value || '';
                }
                if (record.name && record.id) parsedRecords.push(record); // Require ID and Name
            }
            return parsedRecords;
        }

        function displayRecords() {
            const tbody = document.getElementById('recordBody');
            tbody.innerHTML = '';
            records.forEach((record, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.id || ''}</td>
                    <td>${record.name || ''}</td>
                    <td>${record.birthDate || ''}</td>
                    <td>${record.birthPlace || ''}</td>
                    <td>${record.marriage || ''}</td>
                    <td>${record.deathDate || ''}</td>
                    <td>${record.deathPlace || ''}</td>
                    <td>${record.burialPlace || ''}</td>
                    <td>${record.notes || ''}</td>
                    <td>
                        <button onclick="editRecord(${index})">Edit</button>
                        <button onclick="deleteRecord(${index})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addOrUpdateRecord() {
            const editIndex = document.getElementById('editIndex').value;
            const record = {
                id: document.getElementById('id').value,
                name: document.getElementById('name').value,
                birthDate: document.getElementById('birthDate').value,
                birthPlace: document.getElementById('birthPlace').value,
                marriage: document.getElementById('marriage').value,
                deathDate: document.getElementById('deathDate').value,
                deathPlace: document.getElementById('deathPlace').value,
                burialPlace: document.getElementById('burialPlace').value,
                notes: document.getElementById('notes').value
            };
            if (!record.id || !record.name) {
                alert('ID and Name are required.');
                return;
            }
            if (editIndex === '') {
                records.push(record);
            } else {
                records[parseInt(editIndex)] = record;
            }
            displayRecords();
            clearForm();
        }

        function editRecord(index) {
            const record = records[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('id').value = record.id || '';
            document.getElementById('name').value = record.name || '';
            document.getElementById('birthDate').value = record.birthDate || '';
            document.getElementById('birthPlace').value = record.birthPlace || '';
            document.getElementById('marriage').value = record.marriage || '';
            document.getElementById('deathDate').value = record.deathDate || '';
            document.getElementById('deathPlace').value = record.deathPlace || '';
            document.getElementById('burialPlace').value = record.burialPlace || '';
            document.getElementById('notes').value = record.notes || '';
        }

        function deleteRecord(index) {
            if (confirm('Are you sure you want to delete this record?')) {
                records.splice(index, 1);
                displayRecords();
            }
        }

        function clearForm() {
            document.getElementById('editIndex').value = '';
            document.getElementById('id').value = '';
            document.getElementById('name').value = '';
            document.getElementById('birthDate').value = '';
            document.getElementById('birthPlace').value = '';
            document.getElementById('marriage').value = '';
            document.getElementById('deathDate').value = '';
            document.getElementById('deathPlace').value = '';
            document.getElementById('burialPlace').value = '';
            document.getElementById('notes').value = '';
        }

        function downloadText() {
            const textContent = records.map(record => 
                `ID: ${record.id}\nName: ${record.name}\nBirth Date: ${record.birthDate}\nBirth Place: ${record.birthPlace}\nMarriage: ${record.marriage}\nDeath Date: ${record.deathDate}\nDeath Place: ${record.deathPlace}\nBurial Place: ${record.burialPlace}\nNotes: ${record.notes}\n---`
            ).join('\n');
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'updated_genealogy.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
